# 移除 @vercel/postgres-kysely，使用标准 kysely 和 pg

## 问题根源
`@vercel/postgres-kysely` 包只导出了 `createKysely`，没有 `createClient`。这个包专门为 Vercel Postgres 设计，不支持其他数据库（如 Supabase）。

## 解决方案
移除 `@vercel/postgres-kysely` 依赖，改用标准的 `kysely` 和 `pg` 库。

### 1. 更新 packages/db/package.json
移除 `@vercel/postgres-kysely`，添加标准依赖：
```json
"dependencies": {
  "kysely": "^0.27.3",
  "pg": "^8.11.0",
  "prisma-kysely": "1.7.1",
  "@types/pg": "^8.11.0"
}
```

### 2. 更新 packages/auth/package.json
移除 `@vercel/postgres-kysely`，添加标准依赖：
```json
"dependencies": {
  "@auth/kysely-adapter": "0.4.2",
  "kysely": "^0.27.3",
  "pg": "^8.11.0",
  "@t3-oss/env-nextjs": "0.8.0",
  "next": "14.2.5",
  "next-auth": "4.24.7",
  "react": "18.3.1",
  "react-dom": "18.3.1",
  "zod": "3.22.4"
}
```

### 3. 更新 packages/db/index.ts
使用标准 Kysely 配置：
```typescript
import { Pool } from "pg";
import { Kysely } from "kysely";
import type { DB } from "./prisma/types";

export { jsonArrayFrom, jsonObjectFrom } from "kysely/helpers/postgres";
export * from "./prisma/types";
export * from "./prisma/enums";

const pool = new Pool({
  connectionString: process.env.POSTGRES_URL,
});

export const db = new Kysely<DB>({ dialect: { pool } });
```

### 4. 更新 packages/auth/db.ts
使用标准 Kysely 配置：
```typescript
import { Pool } from "pg";
import { Kysely } from "kysely";
import type { GeneratedAlways } from "kysely";

interface Database {
  // ... existing interface
}

const pool = new Pool({
  connectionString: process.env.POSTGRES_URL,
});

export const db = new Kysely<Database>({ dialect: { pool } });
```

## 优势
- 使用标准的 `kysely` 和 `pg` 库，更通用
- 可以连接任何 PostgreSQL 数据库（包括 Supabase）
- 不依赖 Vercel 特定功能